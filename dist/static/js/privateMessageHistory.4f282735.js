"use strict";(self["webpackChunkwangyiyun_app"]=self["webpackChunkwangyiyun_app"]||[]).push([[78],{5025:function(e,t,n){n.r(t),n.d(t,{default:function(){return oe}});var l=n(8551),a=n(9812),r=n(521),i=n(5109),s=n(102),o=n(407),u=n(6183),c=n(6301),d=n(3889),g=n(2649);function p(e){return Array.isArray(e)?!e.length:0!==e&&!e}function m(e,t){if(p(e)){if(t.required)return!1;if(!1===t.validateEmpty)return!0}return!(t.pattern&&!t.pattern.test(String(e)))}function f(e,t){return new Promise((n=>{const l=t.validator(e,t);(0,c.tI)(l)?l.then(n):n(l)}))}function v(e,t){const{message:n}=t;return(0,c.mf)(n)?n(e,t):n||""}function h({target:e}){e.composing=!0}function y({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function b(e,t){const n=(0,g.oD)();e.style.height="auto";let l=e.scrollHeight;if((0,c.Kn)(t)){const{maxHeight:e,minHeight:n}=t;void 0!==e&&(l=Math.min(l,e)),void 0!==n&&(l=Math.max(l,n))}l&&(e.style.height=`${l}px`,(0,g.kn)(n))}function x(e){return"number"===e?{type:"text",inputmode:"decimal"}:"digit"===e?{type:"tel",inputmode:"numeric"}:{type:e}}function w(e){return[...e].length}function k(e,t){return[...e].slice(0,t).join("")}var M=n(8785),C=n(9207);const[S,W]=(0,i["do"])("cell"),V={tag:(0,s.SQ)("div"),icon:String,size:String,title:s.Or,value:s.Or,label:s.Or,center:Boolean,isLink:Boolean,border:s.J5,required:Boolean,iconPrefix:String,valueClass:s.Vg,labelClass:s.Vg,titleClass:s.Vg,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},I=(0,o.l7)({},V,M.g2);var q=(0,a.aZ)({name:S,props:I,setup(e,{slots:t}){const n=(0,M.yj)(),l=()=>{const n=t.label||(0,c.Xq)(e.label);if(n)return(0,a.Wm)("div",{class:[W("label"),e.labelClass]},[t.label?t.label():e.label])},r=()=>{var n;if(t.title||(0,c.Xq)(e.title)){const r=null==(n=t.title)?void 0:n.call(t);if(Array.isArray(r)&&0===r.length)return;return(0,a.Wm)("div",{class:[W("title"),e.titleClass],style:e.titleStyle},[r||(0,a.Wm)("span",null,[e.title]),l()])}},i=()=>{const n=t.value||t.default,l=n||(0,c.Xq)(e.value);if(l)return(0,a.Wm)("div",{class:[W("value"),e.valueClass]},[n?n():(0,a.Wm)("span",null,[e.value])])},s=()=>t.icon?t.icon():e.icon?(0,a.Wm)(C.JO,{name:e.icon,class:W("left-icon"),classPrefix:e.iconPrefix},null):void 0,o=()=>{if(t["right-icon"])return t["right-icon"]();if(e.isLink){const t=e.arrowDirection&&"right"!==e.arrowDirection?`arrow-${e.arrowDirection}`:"arrow";return(0,a.Wm)(C.JO,{name:t,class:W("right-icon")},null)}};return()=>{var l;const{tag:u,size:c,center:d,border:g,isLink:p,required:m}=e,f=null!=(l=e.clickable)?l:p,v={center:d,required:m,clickable:f,borderless:!g};return c&&(v[c]=!!c),(0,a.Wm)(u,{class:W(v),role:f?"button":void 0,tabindex:f?0:void 0,onClick:n},{default:()=>{var e;return[s(),r(),i(),o(),null==(e=t.extra)?void 0:e.call(t)]}})}}}),T=n(6635),B=n(5588),D=n(473);const H=(0,l.n)(q);const[O,U]=(0,i["do"])("field"),P={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:s.Or,formatter:Function,clearIcon:(0,s.SQ)("clear"),modelValue:(0,s.SI)(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:(0,s.SQ)("focus"),formatTrigger:(0,s.SQ)("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},A=(0,o.l7)({},V,P,{rows:s.Or,type:(0,s.SQ)("text"),rules:Array,autosize:[Boolean,Object],labelWidth:s.Or,labelClass:s.Vg,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var E=(0,a.aZ)({name:O,props:A,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:t,slots:n}){const l=(0,B.M)(),i=(0,r.qj)({status:"unvalidated",focused:!1,validateMessage:""}),s=(0,r.iH)(),M=(0,r.iH)(),S=(0,r.iH)(),{parent:W}=(0,T.NB)(u.WN),V=()=>{var t;return String(null!=(t=e.modelValue)?t:"")},I=t=>(0,c.Xq)(e[t])?e[t]:W&&(0,c.Xq)(W.props[t])?W.props[t]:void 0,q=(0,a.Fl)((()=>{const t=I("readonly");if(e.clearable&&!t){const t=""!==V(),n="always"===e.clearTrigger||"focus"===e.clearTrigger&&i.focused;return t&&n}return!1})),O=(0,a.Fl)((()=>S.value&&n.input?S.value():e.modelValue)),P=e=>e.reduce(((e,t)=>e.then((()=>{if("failed"===i.status)return;let{value:e}=O;if(t.formatter&&(e=t.formatter(e,t)),!m(e,t))return i.status="failed",void(i.validateMessage=v(e,t));if(t.validator){if(p(e)&&!1===t.validateEmpty)return;return f(e,t).then((n=>{n&&"string"===typeof n?(i.status="failed",i.validateMessage=n):!1===n&&(i.status="failed",i.validateMessage=v(e,t))}))}}))),Promise.resolve()),A=()=>{i.status="unvalidated",i.validateMessage=""},E=()=>t("endValidate",{status:i.status,message:i.validateMessage}),$=(n=e.rules)=>new Promise((l=>{A(),n?(t("startValidate"),P(n).then((()=>{"failed"===i.status?(l({name:e.name,message:i.validateMessage}),E()):(i.status="passed",l(),E())}))):l()})),_=t=>{if(W&&e.rules){const{validateTrigger:n}=W.props,l=(0,o.qo)(n).includes(t),a=e.rules.filter((e=>e.trigger?(0,o.qo)(e.trigger).includes(t):l));a.length&&$(a)}},z=t=>{var n;const{maxlength:l}=e;if((0,c.Xq)(l)&&w(t)>+l){const e=V();if(e&&w(e)===+l)return e;const a=null==(n=s.value)?void 0:n.selectionEnd;if(i.focused&&a){const e=[...t],n=e.length-+l;return e.splice(a-n,n),e.join("")}return k(t,+l)}return t},F=(n,l="onChange")=>{const a=n;n=z(n);const r=w(a)-w(n);if("number"===e.type||"digit"===e.type){const t="number"===e.type;n=(0,d.uf)(n,t,t)}let o=0;if(e.formatter&&l===e.formatTrigger){const{formatter:t,maxlength:l}=e;if(n=t(n),(0,c.Xq)(l)&&w(n)>+l&&(n=k(n,+l)),s.value&&i.focused){const{selectionEnd:e}=s.value,n=k(a,e);o=w(t(n))-w(n)}}if(s.value&&s.value.value!==n)if(i.focused){let{selectionStart:e,selectionEnd:t}=s.value;if(s.value.value=n,(0,c.Xq)(e)&&(0,c.Xq)(t)){const l=w(n);r?(e-=r,t-=r):o&&(e+=o,t+=o),s.value.setSelectionRange(Math.min(e,l),Math.min(t,l))}}else s.value.value=n;n!==e.modelValue&&t("update:modelValue",n)},J=e=>{e.target.composing||F(e.target.value)},L=()=>{var e;return null==(e=s.value)?void 0:e.blur()},X=()=>{var e;return null==(e=s.value)?void 0:e.focus()},Q=()=>{const t=s.value;"textarea"===e.type&&e.autosize&&t&&b(t,e.autosize)},N=e=>{i.focused=!0,t("focus",e),(0,a.Y3)(Q),I("readonly")&&L()},Y=e=>{I("readonly")||(i.focused=!1,F(V(),"onBlur"),t("blur",e),_("onBlur"),(0,a.Y3)(Q),(0,g.pe)())},j=e=>t("clickInput",e),K=e=>t("clickLeftIcon",e),R=e=>t("clickRightIcon",e),Z=e=>{(0,g.PF)(e),t("update:modelValue",""),t("clear",e)},G=(0,a.Fl)((()=>"boolean"===typeof e.error?e.error:!(!W||!W.props.showError||"failed"!==i.status)||void 0)),ee=(0,a.Fl)((()=>{const e=I("labelWidth");if(e)return{width:(0,d.Nn)(e)}})),te=n=>{const l=13;if(n.keyCode===l){const t=W&&W.props.submitOnEnter;t||"textarea"===e.type||(0,g.PF)(n),"search"===e.type&&L()}t("keypress",n)},ne=()=>e.id||`${l}-input`,le=()=>i.status,ae=()=>{const t=U("control",[I("inputAlign"),{error:G.value,custom:!!n.input,"min-height":"textarea"===e.type&&!e.autosize}]);if(n.input)return(0,a.Wm)("div",{class:t,onClick:j},[n.input()]);const r={id:ne(),ref:s,name:e.name,rows:void 0!==e.rows?+e.rows:void 0,class:t,disabled:I("disabled"),readonly:I("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,enterkeyhint:e.enterkeyhint,"aria-labelledby":e.label?`${l}-label`:void 0,onBlur:Y,onFocus:N,onInput:J,onClick:j,onChange:y,onKeypress:te,onCompositionend:y,onCompositionstart:h};return"textarea"===e.type?(0,a.Wm)("textarea",r,null):(0,a.Wm)("input",(0,a.dG)(x(e.type),r),null)},re=()=>{const t=n["left-icon"];if(e.leftIcon||t)return(0,a.Wm)("div",{class:U("left-icon"),onClick:K},[t?t():(0,a.Wm)(C.JO,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},ie=()=>{const t=n["right-icon"];if(e.rightIcon||t)return(0,a.Wm)("div",{class:U("right-icon"),onClick:R},[t?t():(0,a.Wm)(C.JO,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},se=()=>{if(e.showWordLimit&&e.maxlength){const t=w(V());return(0,a.Wm)("div",{class:U("word-limit")},[(0,a.Wm)("span",{class:U("word-num")},[t]),(0,a.Uk)("/"),e.maxlength])}},oe=()=>{if(W&&!1===W.props.showErrorMessage)return;const t=e.errorMessage||i.validateMessage;if(t){const e=n["error-message"],l=I("errorMessageAlign");return(0,a.Wm)("div",{class:U("error-message",l)},[e?e({message:t}):t])}},ue=()=>{const t=I("colon")?":":"";return n.label?[n.label(),t]:e.label?(0,a.Wm)("label",{id:`${l}-label`,for:ne()},[e.label+t]):void 0},ce=()=>[(0,a.Wm)("div",{class:U("body")},[ae(),q.value&&(0,a.Wm)(C.JO,{ref:M,name:e.clearIcon,class:U("clear")},null),ie(),n.button&&(0,a.Wm)("div",{class:U("button")},[n.button()])]),se(),oe()];return(0,D.F)({blur:L,focus:X,validate:$,formValue:O,resetValidation:A,getValidationStatus:le}),(0,a.JJ)(T.F1,{customValue:S,resetValidation:A,validateWithTrigger:_}),(0,a.YP)((()=>e.modelValue),(()=>{F(V()),A(),_("onChange"),(0,a.Y3)(Q)})),(0,a.bv)((()=>{F(V(),e.formatTrigger),(0,a.Y3)(Q)})),(0,T.OR)("touchstart",Z,{target:(0,a.Fl)((()=>{var e;return null==(e=M.value)?void 0:e.$el}))}),()=>{const t=I("disabled"),l=I("labelAlign"),r=re(),i=()=>{const e=ue();return"top"===l?[r,e].filter(Boolean):e||[]};return(0,a.Wm)(H,{size:e.size,class:U({error:G.value,disabled:t,[`label-${l}`]:l}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:ee.value,valueClass:U("value"),titleClass:[U("label",[l,{required:e.required}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:r&&"top"!==l?()=>r:null,title:i,value:ce,extra:n.extra})}}});const $=(0,l.n)(E);n(9246),n(7255),n(2069);var _=n(9742),z=(n(3582),n(5893)),F=n(4220);const J=e=>((0,a.dD)("data-v-7334a436"),e=e(),(0,a.Cn)(),e),L={key:0,class:"main"},X={class:"topItemLeft",style:{width:"100%",display:"flex","align-items":"center",height:"20px","background-color":"white",position:"fixed","z-index":"10"}},Q=J((()=>(0,a._)("use",{"xlink:href":"#icon-fanhui"},null,-1))),N=[Q],Y=J((()=>(0,a._)("span",{style:{width:"100%",display:"flex","justify-content":"space-evenly","font-size":"large"}},"网易云私信",-1))),j={class:"userMessage",ref:"listContainer"},K={key:0,class:"fromUser"},R=["src"],Z={key:1,class:"toUser"},G=["src"],ee={class:"userInput"},te=J((()=>(0,a._)("use",{"xlink:href":"#icon-fasong"},null,-1))),ne=[te];function le(e,t,n,l,r,i){const s=_.od,o=$;return 0!==r.historyMessages.length?((0,a.wg)(),(0,a.iD)("div",L,[(0,a._)("div",X,[((0,a.wg)(),(0,a.iD)("svg",{class:"icon","aria-hidden":"true",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},N)),Y]),(0,a._)("div",j,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.historyMessages,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t,class:(0,z.C_)(t==r.historyMessages.length-1?"singleMessage":"lastMessage")},[e.fromUser.userId==r.uid?((0,a.wg)(),(0,a.iD)("div",K,[(0,a._)("img",{src:e.fromUser.avatarUrl},null,8,R),(0,a.Wm)(s,{rows:"999",content:e.msg.msg,"expand-text":"展开","collapse-text":"收起",style:{"max-width":"70%",margin:"30px","margin-left":"0px","margin-top":"0px",border:"1px solid #999","white-space":"pre-line","border-radius":"10px",padding:"8px"}},null,8,["content"])])):(0,a.kq)("",!0),e.fromUser.userId==r.toUid?((0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("img",{src:e.fromUser.avatarUrl},null,8,G),(0,a.Wm)(s,{rows:"999",content:e.msg.msg,"expand-text":"展开","collapse-text":"收起",style:{"max-width":"70%",margin:"30px","margin-right":"0px","margin-top":"0px",border:"1px solid #999","white-space":"pre-line","border-radius":"10px",padding:"8px"}},null,8,["content"])])):(0,a.kq)("",!0)],2)))),128))],512),(0,a._)("div",ee,[(0,a.Wm)(o,{modelValue:r.inputText,"onUpdate:modelValue":t[1]||(t[1]=e=>r.inputText=e),style:{"max-width":"90%","background-color":"rgb(181, 184, 178)",border:"2px solid #999",padding:"0px",height:"70%","border-radius":"5px"},onKeydown:(0,F.D2)(i.sendMessage,["enter"])},null,8,["modelValue","onKeydown"]),((0,a.wg)(),(0,a.iD)("svg",{class:"icon","aria-hidden":"true",onClick:t[2]||(t[2]=e=>i.sendMessage())},ne))])])):(0,a.kq)("",!0)}n(7658);var ae=n(5263),re={name:"privateMessageHistory",data(){return{uid:null,historyMessages:[],toUid:null,inputText:""}},created:async function(){this.uid=this.$route.query.uid,this.toUid=this.$route.query.toUid;var e=new Date;this.historyMessages=(await(0,ae.UB)(this.uid,e)).data.msgs,console.log(this.historyMessages);for(var t=0;t<this.historyMessages.length;t++)this.historyMessages[t].msg=JSON.parse(this.historyMessages[t].msg);this.historyMessages.sort(((e,t)=>e.time-t.time)),this.$nextTick((()=>{const e=this.$refs.listContainer,t=e.lastElementChild;t.scrollIntoView({behavior:"auto"})})),console.log(this.toUid),console.log(this.uid)},methods:{sendMessage:async function(){let e=await(0,ae.sU)(this.uid,this.inputText);this.inputText="";for(var t=0;t<e.data.newMsgs.length;t++)e.data.newMsgs[t].msg=JSON.parse(e.data.newMsgs[t].msg),this.historyMessages.push(e.data.newMsgs[t]);this.$nextTick((()=>{const e=this.$refs.listContainer,t=e.lastElementChild;t.scrollIntoView({behavior:"auto"})})),console.log(1)}}},ie=n(8998);const se=(0,ie.Z)(re,[["render",le],["__scopeId","data-v-7334a436"]]);var oe=se},9742:function(e,t,n){n.d(t,{od:function(){return p}});var l=n(8551),a=n(9812),r=n(521),i=n(6635),s=n(5109),o=n(102);const[u,c]=(0,s["do"])("text-ellipsis"),d={rows:(0,o.SI)(1),content:(0,o.SQ)(""),expandText:(0,o.SQ)(""),collapseText:(0,o.SQ)("")};var g=(0,a.aZ)({name:u,props:d,emits:["clickAction"],setup(e,{emit:t}){const n=(0,r.iH)(""),l=(0,r.iH)(!1),s=(0,r.iH)(!1),o=(0,r.iH)(),u=e=>{if(!e)return 0;const t=e.match(/^\d*(\.\d*)?/);return t?Number(t[0]):0},d=()=>{const t=()=>{if(!o.value)return;const t=window.getComputedStyle(o.value),n=document.createElement("div"),l=Array.prototype.slice.apply(t);return l.forEach((e=>{n.style.setProperty(e,t.getPropertyValue(e))})),n.style.position="fixed",n.style.zIndex="-9999",n.style.top="-9999px",n.style.height="auto",n.style.minHeight="auto",n.style.maxHeight="auto",n.innerText=e.content,document.body.appendChild(n),n},l=(t,n)=>{const{content:l,expandText:a}=e,r="...";let i=0,s=l.length,o=-1;while(i<=s){const e=Math.floor((i+s)/2);t.innerText=l.slice(0,e)+r+a,t.offsetHeight<=n?(i=e+1,o=e):s=e-1}return l.slice(0,o)+r},a=t();if(!a)return;const{paddingBottom:r,paddingTop:i,lineHeight:c}=a.style,d=(Number(e.rows)+.5)*u(c)+u(i)+u(r);d<a.offsetHeight?(s.value=!0,n.value=l(a,d)):(s.value=!1,n.value=e.content),document.body.removeChild(a)},g=e=>{l.value=!l.value,t("clickAction",e)},p=()=>(0,a.Wm)("span",{class:c("action"),onClick:g},[l.value?e.collapseText:e.expandText]);return(0,a.bv)(d),(0,a.YP)((()=>[e.content,e.rows]),d),(0,i.OR)("resize",d),()=>(0,a.Wm)("div",{ref:o,class:c()},[l.value?e.content:n.value,s.value?p():null])}});const p=(0,l.n)(g)},3582:function(e,t,n){n(9246)}}]);
//# sourceMappingURL=privateMessageHistory.4f282735.js.map